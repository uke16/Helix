# Phase 14: Self-Evolution System - Specification

name: Self-Evolution System
type: feature
version: "14.0"
status: planned

description: |
  HELIX v4 Self-Evolution System ermöglicht HELIX, sich selbst
  sicher weiterzuentwickeln durch ein isoliertes Test-System
  und kontrollierte Integration.

goals:
  - HELIX kann eigene Features entwickeln ohne Selbstzerstörung
  - Isoliertes Test-System (helix-v4-test) für sichere Entwicklung
  - Automatische Integration mit Validierung
  - RAG-Datenbank 1:1 Sync für realistische Tests
  - File-basierte Kommunikation (keine Cross-Instance Dialoge)

requirements:
  functional:
    - helix-control.sh für v4 (status, start, stop, restart)
    - helix-v4-test als separates System auf Test-Ports
    - Evolution-Projekte in projects/evolution/
    - new/ für neue Dateien, modified/ für Änderungen
    - Deploy ins Test-System mit Git-Sync
    - Validation (Syntax, Unit Tests, E2E)
    - Integration in Production mit Rollback
    - RAG/Qdrant Sync von Production zu Test
    - API Endpoints für Evolution-Workflow
    - Consultant kann Evolution-Projekte erstellen
  
  non_functional:
    - Test-System läuft parallel zu Production
    - Nur ein Deploy gleichzeitig
    - Mehrere Evolution-Projekte parallel entwickelbar
    - Rollback bei Fehlern möglich

constraints:
  - Consultant darf helix-v4 NIE direkt modifizieren
  - Integration nur über definierten Mechanismus
  - Test-System muss unabhängig startbar sein
  - Git-basiertes Rollback

technical:
  language: python
  new_package: src/helix/evolution/
  new_modules:
    - project.py (Evolution Project Manager)
    - deployer.py (Deploy to Test)
    - validator.py (Syntax, Tests)
    - integrator.py (Integrate to Production)
    - rag_sync.py (Qdrant Sync)
  api_routes:
    - /helix/evolution/projects
    - /helix/evolution/projects/{name}/deploy
    - /helix/evolution/projects/{name}/validate
    - /helix/evolution/projects/{name}/integrate
    - /helix/evolution/sync-rag
  
  ports:
    production:
      api: 8001
      postgres: 5432
      neo4j_http: 7474
      neo4j_bolt: 7687
      qdrant_http: 6333
      redis: 6379
    test:
      api: 9001
      postgres: 5433
      neo4j_http: 7475
      neo4j_bolt: 7688
      qdrant_http: 6335
      redis: 6380

context:
  what: |
    Ein System das HELIX ermöglicht, sich selbst weiterzuentwickeln.
    Der Consultant bespricht Features mit dem User, Developer-Instanzen
    implementieren in projects/evolution/, Code wird ins Test-System
    deployed und validiert, bei Erfolg in Production integriert.
    
  why: |
    Ohne Self-Evolution kann HELIX nicht an sich selbst arbeiten.
    Direkte Modifikation ist gefährlich (Syntax-Fehler, Breaking Changes).
    Das isolierte Test-System ermöglicht sicheres Experimentieren.

  communication_model: |
    Claude Code Instanzen sind kurzlebig. Keine Echtzeit-Kommunikation.
    Stattdessen: File-basiert wie "Zettel auf dem Kühlschrank".
    - spec.yaml, phases.yaml (Aufgaben)
    - status.json (Fortschritt)
    - new/, modified/ (Code)

references:
  - docs/EVOLUTION-CONCEPT.md
  - /home/aiuser01/helix-v3/control/helix-v3-control.sh
  - /home/aiuser01/helix-v3-test/docker/testsystem/docker-compose.yaml
