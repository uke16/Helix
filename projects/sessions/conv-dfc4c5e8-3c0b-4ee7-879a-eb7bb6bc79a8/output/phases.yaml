phases:
  - id: 01-path-consolidation
    name: "PathConfig Consolidation"
    type: development
    description: |
      Konsolidierung aller hardcoded Pfade auf PathConfig:
      
      1. PathConfig erweitern um fehlende Properties:
         - DOMAIN_EXPERTS_CONFIG
         - LLM_PROVIDERS_CONFIG
         - SKILLS_DIR
         - TEMPLATES_DIR
         - TEMPLATES_PHASES
         - TEST_ROOT
      
      2. Alle 12 Dateien auf PathConfig umstellen:
         - expert_manager.py
         - llm_client.py
         - template_engine.py
         - phase_loader.py
         - context_manager.py
         - claude_runner.py
         - openai.py
         - main.py
         - deployer.py
         - integrator.py
         - validator.py
         - project.py
      
      3. sys.path.insert() Manipulation entfernen
      
      4. pyproject.toml Package-Setup verifizieren
    config:
      skills: [helix, infrastructure]
    input:
      files:
        - src/helix/config/paths.py
    output:
      files:
        - phases/01-path-consolidation/output/paths.py
        - phases/01-path-consolidation/output/MIGRATION-REPORT.md
    quality_gate:
      type: grep_forbidden
      patterns:
        - "/home/aiuser01"
        - "sys.path.insert"

  - id: 02-lsp-activation
    name: "LSP Activation"
    type: development
    description: |
      LSP für alle Entwickler aktivieren:
      
      1. ENABLE_LSP_TOOL=1 in config/env.sh setzen
      
      2. pyright in pyproject.toml dev dependencies:
         - pyright>=1.1.350
         - python-lsp-server[all]>=1.10.0
      
      3. Optional: PhaseExecutor LSP-Env automatisch setzen
         für development, review, integration Phasen
      
      4. Verifizieren dass LSP funktioniert:
         - Go-to-Definition
         - Find-References
         - Hover-Info
      
      5. ADR-018 Status auf "Accepted" setzen
    config:
      skills: [helix, infrastructure]
    input:
      files:
        - config/env.sh
        - pyproject.toml
        - adr/018-lsp-integration.md
    output:
      files:
        - phases/02-lsp-activation/output/env.sh
        - phases/02-lsp-activation/output/pyproject.toml
        - phases/02-lsp-activation/output/LSP-VERIFICATION.md
    quality_gate:
      type: command
      command: "pyright --version"

  - id: 03-documentation
    name: "Documentation Hardening"
    type: documentation
    description: |
      Dokumentation vervollständigen und bereinigen:
      
      1. Neue Dokumentation erstellen:
         - docs/CONFIGURATION-GUIDE.md (Environment Variables, Pfad-Config)
         - docs/PATHS.md (PathConfig API Reference)
      
      2. ConsultantMeeting in ARCHITECTURE-MODULES.md dokumentieren:
         - 4-Phasen-Architektur erklären
         - Multi-Expert-Szenarien dokumentieren
         - "Wann nutze ich X vs Y" Decision Tree
      
      3. ADR-Status korrigieren:
         - ADR-018: Proposed -> Accepted
         - ADR-020: Widersprüchlichen "Implemented" Kommentar entfernen
      
      4. Context-Optimierung:
         - Session-Details (Zeilen 349-457) nach SESSION-MANAGEMENT.md extrahieren
         - API Middleware Details nach API-CONFIGURATION.md verschieben
      
      5. INDEX.md aktualisieren
    config:
      skills: [helix]
    input:
      files:
        - docs/ARCHITECTURE-MODULES.md
        - adr/018-lsp-integration.md
        - adr/020-intelligent-documentation-discovery.md
    output:
      files:
        - phases/03-documentation/output/CONFIGURATION-GUIDE.md
        - phases/03-documentation/output/PATHS.md
        - phases/03-documentation/output/ARCHITECTURE-MODULES.md
        - phases/03-documentation/output/SESSION-MANAGEMENT.md
    quality_gate:
      type: files_exist

  - id: 04-verification
    name: "Verification & Testing"
    type: testing
    description: |
      Finale Verifikation:
      
      1. Tests auf sauberem Verzeichnis ausführen:
         - HELIX_ROOT=/tmp/helix-test pytest
         - Verifizieren dass keine hardcoded paths mehr existieren
      
      2. LSP funktioniert:
         - Go-to-Definition auf beliebige Python-Datei testen
         - pyright src/ läuft ohne Errors
      
      3. Dokumentation review:
         - Alle neuen .md Dateien existieren
         - Links funktionieren
         - ADR-Status korrekt
      
      4. Grep-Checks:
         - grep -r "/home/aiuser01" src/ = leer
         - grep -r "sys.path.insert" src/ = leer
      
      5. Integration:
         - API starten und testen
         - Consultant Session starten
    config:
      skills: [helix, infrastructure]
    input:
      files:
        - phases/01-path-consolidation/output/*
        - phases/02-lsp-activation/output/*
        - phases/03-documentation/output/*
    output:
      files:
        - phases/04-verification/output/VERIFICATION-REPORT.md
    quality_gate:
      type: tests_pass
