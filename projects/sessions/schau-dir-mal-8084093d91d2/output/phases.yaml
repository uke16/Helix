phases:
  - id: 01-security-fixes
    name: Security Fixes (KRITISCH)
    type: development
    description: |
      Implementiere die kritischen Security Fixes:
      1. Random Session IDs statt Hash-basiert
      2. Input Validation Middleware (Role, Length)
      3. Rate Limiting (10 req/min)
      4. Path Traversal Prevention

      Dependencies hinzufügen: slowapi, filelock
    config:
      skills: [helix, infrastructure]
    input:
      files:
        - adr/035-consultant-hardening.md
    output:
      files:
        - phases/01-security-fixes/output/middleware/rate_limiter.py
        - phases/01-security-fixes/output/middleware/input_validator.py
        - phases/01-security-fixes/output/modified/session_manager.py
    quality_gate:
      type: python_syntax

  - id: 02-reliability-fixes
    name: Reliability Fixes (HOCH)
    type: development
    description: |
      Implementiere die Reliability Fixes:
      1. File Locking für Session-Erstellung
      2. Session Cleanup Funktion
      3. Cleanup-Job/Endpoint

      Nutze filelock für atomare Operationen.
    config:
      skills: [helix, infrastructure]
    input:
      files:
        - phases/01-security-fixes/output/modified/session_manager.py
    output:
      files:
        - phases/02-reliability-fixes/output/modified/session_manager.py
    quality_gate:
      type: python_syntax

  - id: 03-code-quality
    name: Code Quality (MITTEL)
    type: development
    description: |
      Implementiere die Code Quality Fixes:
      1. Zentrale PathConfig (config/paths.py)
      2. DRY für PATH-Setup in openai.py
      3. Refactor claude_runner.py für PathConfig
    config:
      skills: [helix]
    input:
      files:
        - phases/02-reliability-fixes/output/modified/session_manager.py
    output:
      files:
        - phases/03-code-quality/output/config/paths.py
        - phases/03-code-quality/output/modified/openai.py
        - phases/03-code-quality/output/modified/claude_runner.py
    quality_gate:
      type: python_syntax

  - id: 04-testing
    name: Tests schreiben
    type: test
    description: |
      Schreibe Unit Tests für alle neuen Komponenten:
      1. test_rate_limiter.py
      2. test_input_validator.py
      3. test_session_security.py (Session IDs, Path Sanitization)
      4. test_cleanup.py
    config:
      skills: [helix]
    input:
      files:
        - phases/03-code-quality/output/config/paths.py
        - phases/03-code-quality/output/modified/session_manager.py
    output:
      files:
        - phases/04-testing/output/tests/test_rate_limiter.py
        - phases/04-testing/output/tests/test_input_validator.py
        - phases/04-testing/output/tests/test_session_security.py
    quality_gate:
      type: files_exist

  - id: 05-documentation
    name: Dokumentation aktualisieren
    type: documentation
    description: |
      Aktualisiere die Dokumentation:
      1. ARCHITECTURE-MODULES.md: Security-Sektion hinzufügen
      2. Neue Environment Variables dokumentieren
      3. Rate Limiting dokumentieren
    config:
      skills: [helix]
    input:
      files:
        - phases/03-code-quality/output/config/paths.py
    output:
      files:
        - phases/05-documentation/output/ARCHITECTURE-MODULES-update.md
    quality_gate:
      type: files_exist
