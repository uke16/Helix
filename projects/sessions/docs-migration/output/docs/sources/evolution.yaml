# docs/sources/evolution.yaml
# PRIMARY SOURCE for Evolution System in HELIX v4
#
# This file defines the self-evolution capabilities of HELIX.
# All documentation is generated from this file.
#
# Regenerate docs: python -m helix.tools.docs_compiler compile

_meta:
  version: "1.0"
  description: "Evolution System Definitions for HELIX v4"
  generated_outputs:
    - CLAUDE.md
    - skills/helix/SKILL.md
    - skills/helix/evolution/SKILL.md

evolution:
  description: "HELIX supports self-evolution through isolated test system validation"

  project_location: "projects/evolution/{name}/"

  directory_structure:
    - path: "spec.yaml"
      description: "Project specification"
    - path: "phases.yaml"
      description: "Development phases"
    - path: "status.json"
      description: "Current status"
    - path: "new/"
      description: "New files to create"
      example: "src/helix/..."
    - path: "modified/"
      description: "Modified files"
      example: "src/helix/..."

  status_flow:
    states:
      - PENDING
      - DEVELOPING
      - READY
      - DEPLOYED
      - VALIDATED
      - INTEGRATED
      - FAILED
      - ROLLBACK

    transitions:
      - from: PENDING
        to: DEVELOPING
      - from: DEVELOPING
        to: READY
      - from: READY
        to: DEPLOYED
      - from: DEPLOYED
        to: VALIDATED
      - from: DEPLOYED
        to: FAILED
      - from: VALIDATED
        to: INTEGRATED
      - from: VALIDATED
        to: ROLLBACK
      - from: FAILED
        to: ROLLBACK

    diagram: |
      PENDING → DEVELOPING → READY → DEPLOYED → VALIDATED → INTEGRATED
                                    ↓           ↓
                                 FAILED ← ← ← ROLLBACK

  api:
    base_url: "http://localhost:8001/helix/evolution"

    endpoints:
      - name: "List projects"
        method: GET
        path: "/projects"
        curl: "curl http://localhost:8001/helix/evolution/projects"

      - name: "Deploy to test"
        method: POST
        path: "/projects/{name}/deploy"
        curl: "curl -X POST http://localhost:8001/helix/evolution/projects/{name}/deploy"

      - name: "Validate"
        method: POST
        path: "/projects/{name}/validate"
        curl: "curl -X POST http://localhost:8001/helix/evolution/projects/{name}/validate"

      - name: "Integrate"
        method: POST
        path: "/projects/{name}/integrate"
        curl: "curl -X POST http://localhost:8001/helix/evolution/projects/{name}/integrate"

  safety_guarantees:
    - number: 1
      guarantee: "Changes always deploy to test system first"
    - number: 2
      guarantee: "Full validation (syntax, unit, E2E) before integration"
    - number: 3
      guarantee: "Automatic rollback on failure"
    - number: 4
      guarantee: "Git tag backup before integration"
    - number: 5
      guarantee: "RAG database 1:1 copy for realistic testing"

  when_to_use:
    - "Modifying HELIX orchestrator itself"
    - "Adding new Quality Gates"
    - "Changing phase execution logic"
    - "Updating template generation"
