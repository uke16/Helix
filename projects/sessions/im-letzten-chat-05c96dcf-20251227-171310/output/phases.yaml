# Workflow: intern-simple (HELIX Internal Hotfix)
# ADR: ADR-027 Stale Response Bugfix
# Typ: Bugfix - klar definiert, eine Datei, schneller Fix

workflow: intern-simple
project_type: helix_internal

phases:
  - id: "1"
    name: Implementation & Test
    type: development
    description: |
      Implementiere die 3 Bug-Fixes in openai.py:

      1. Lösche alte response.md vor Claude-Start
      2. Validiere Timestamp der response.md
      3. Bei Timeout/Error: Explizite Meldung, keine alte Response

      Da dies ein Hotfix ist, werden Implementation und Test in einer Phase
      kombiniert für schnellere Durchführung.
    config:
      skills:
        - helix
      max_retries: 2
    input:
      files:
        - ADR-stale-response-bugfix.md
    output:
      files:
        - phases/1/output/modified/src/helix/api/routes/openai.py
    quality_gate:
      type: python_syntax
    verify_agent: true

  - id: "2"
    name: Deploy & Validate
    type: test
    description: |
      Deploy zum HELIX Testsystem und validiere:

      1. Deploy der modifizierten openai.py
      2. API Neustart im Testsystem
      3. Manueller Test: Timeout-Szenario
      4. Manueller Test: Normale Antwort

      Bei erfolgreichem Test: Ready für Integration
    config:
      skills:
        - helix
        - infrastructure
    input:
      files:
        - phases/1/output/modified/src/helix/api/routes/openai.py
    output:
      files:
        - phases/2/output/validation-report.md
    quality_gate:
      type: files_exist
    verify_agent: true

  - id: "3"
    name: Integration
    type: integration
    description: |
      Integration in Production:

      1. Kopiere modifizierte Datei nach src/helix/api/routes/
      2. Starte Production API neu
      3. Verifiziere dass Fix aktiv ist
      4. Markiere ADR als Implemented
    config:
      skills:
        - helix
    input:
      files:
        - phases/2/output/validation-report.md
    output:
      files:
        - phases/3/output/integration-complete.md
    quality_gate:
      type: files_exist

# Evolution Workflow Konfiguration
evolution:
  # Das Testsystem wird auf die gleiche Git-Version gebracht wie Production
  sync_git_version: true

  # Nach Deploy: Vollständige Validierung
  validation:
    - syntax_check
    - unit_tests
    - e2e_tests

  # Bei Fehler: Automatischer Rollback
  rollback_on_failure: true
