# Workflow: Intern Complex
# Komplexes internes HELIX-Projekt (helix_internal)
#
# Ablauf: Feasibility -> Planning-Agent -> [1-5 dynamische Phasen] -> Verify -> Docs -> Deploy-Test -> E2E -> Deploy-Prod

name: intern-complex
description: Komplexes internes HELIX-Projekt mit dynamischer Phasen-Generierung
project_type: helix_internal
complexity: complex
max_retries: 3  # Pro Phase mit Sub-Agent Verifikation
max_dynamic_phases: 5  # Maximum für dynamisch generierte Phasen

phases:
  - id: feasibility
    name: "Feasibility Check"
    type: consultant
    description: "Prüfe Machbarkeit und identifiziere Risiken"
    template: consultant/feasibility.md
    output:
      - "feasibility-report.md"
    quality_gate:
      type: review_approved
    verify_agent: true
    optional: true  # Kann übersprungen werden bei klarer Anforderung

  - id: planning-agent
    name: "Planning Agent"
    type: planning
    description: "Analysiere Anforderungen und generiere dynamische Phasen"
    template: consultant/planning-agent.md
    output:
      - "ADR-*.md"
      - "phases.yaml"
      - "decomposed-phases.yaml"
    quality_gate:
      type: adr_valid
    verify_agent: true
    generates_phases: true  # Markiert dass dieser Schritt Phasen generiert
    phase_config:
      min_phases: 1
      max_phases: 5
      phase_template: developer/python.md

  # Dynamische Phasen werden hier eingefügt
  # Format: dev-{n} mit n = 1..max_dynamic_phases
  # Beispiel:
  #   - id: dev-1
  #     name: "Development Phase 1: Data Layer"
  #     type: development
  #     ...

  - id: verify
    name: "Verification"
    type: test
    description: "Umfassende Tests aller implementierten Komponenten"
    template: testing/comprehensive.md
    output:
      - "tests/**/*.py"
    quality_gate:
      type: tests_pass
    verify_agent: true
    after_dynamic: true  # Kommt nach den dynamischen Phasen

  - id: documentation
    name: "Documentation"
    type: documentation
    description: "Vollständige Dokumentation inkl. ARCHITECTURE-MODULES.md"
    template: documentation/comprehensive.md
    output:
      - "docs/**/*.md"
      - "CLAUDE.md"
      - "skills/**/*.md"
    quality_gate:
      type: files_exist
    verify_agent: true
    after_dynamic: true

  - id: deploy-test
    name: "Deploy to Test"
    type: deploy
    target: test
    description: "Deploy zum isolierten Test-System"
    template: deploy/test.md
    quality_gate:
      type: deploy_success
    verify_agent: true
    after_dynamic: true

  - id: e2e
    name: "E2E Tests"
    type: test
    description: "Vollständige End-to-End Validierung"
    template: testing/e2e-comprehensive.md
    output:
      - "tests/e2e/**/*.py"
    quality_gate:
      type: tests_pass
    verify_agent: true
    after_dynamic: true

  - id: deploy-prod
    name: "Deploy to Production"
    type: deploy
    target: production
    description: "Integration ins Produktiv-System nach Validierung"
    template: deploy/production.md
    quality_gate:
      type: integration_pass
    verify_agent: true
    requires_approval: true  # Manuelle Freigabe vor Prod-Deploy
    after_dynamic: true

# Dynamische Phase Template
dynamic_phase_template:
  id: "dev-{n}"
  name: "Development Phase {n}: {description}"
  type: development
  template: developer/python.md
  output:
    - "src/**/*.py"
  quality_gate:
    type: syntax_check
  verify_agent: true
